const btn_play=document.getElementById("btn-play"),video_tribute=document.getElementById("tribute-home-video"),formCreateName="form#form-create-tribute",formCreate=document.querySelector(formCreateName),slug=document.getElementById("slug"),nameInput=document.getElementById("name_honored"),formsResend=document.querySelectorAll(".resend-email"),SESSION_OBJ_INVITES="polen_tributes_invites";function playVideo(e){video_tribute.paused?(btn_play.classList.add("hidden"),video_tribute.play()):(btn_play.classList.remove("hidden"),video_tribute.pause())}function slugValidate(e,t){const n=document.getElementById("slug-message");slug.classList.remove("error"),n.classList.remove("error"),n.innerText="",e||(slug.classList.add("error"),n.classList.add("error")),n.innerText=t}function getSlug(){slug.value||(slug.value=polSlugfy(nameInput.value),checkSlug())}function checkSlug(){polSpinner(CONSTANTS.SHOW,".slug-wrap"),slug.value=polSlugfy(slug.value),jQuery.ajax({type:"POST",url:polenObj.ajax_url,data:{action:"check_tribute_slug_exists",slug:slug.value},success:function(e){e.success?slugValidate(!0,e.data):slugValidate(!1,e.data)},error:function(e,t,n){slugValidate(!1,e.responseJSON.data)},complete:function(){polSpinner(CONSTANTS.HIDDEN)}})}function createTribute(e){e.preventDefault(),slug.classList.contains("error")?polError("É preciso uma URL válida para seu Colab"):document.getElementById("deadline").classList.contains("error")?polError("Data inválida. A data não pode ser anterior a de hoje."):(polSpinner(),jQuery.post(polenObj.ajax_url,jQuery(formCreateName).serialize(),(function(e){e.success?(setSessionMessage(CONSTANTS.SUCCESS,"Colab criado","Agora convide seus amigos para essa homenagem"),window.location.href=e.data.url_redirect):polError(e.data)})).fail((function(e){polSpinner(CONSTANTS.HIDDEN),e.responseJSON?polError(e.responseJSON.data):polError(e.statusText)})))}function reSendEmail(e){e.preventDefault(),polAjaxForm("form#"+e.target.id,(function(){polMessage("Enviado","e-mail foi enviado com sucesso")}),(function(e){polError(e)}))}if(btn_play&&btn_play.addEventListener("click",playVideo),slug&&(slug.addEventListener("focusout",checkSlug),nameInput.addEventListener("focusout",getSlug)),formCreate&&formCreate.addEventListener("submit",createTribute),formsResend.length&&formsResend.forEach((function(e){e.addEventListener("submit",reSendEmail)})),document.getElementById("invite-friends")){function saveToDisk(e){sessionStorage.setItem(SESSION_OBJ_INVITES,JSON.stringify(e))}function getToDisk(){const e=sessionStorage.getItem(SESSION_OBJ_INVITES);return e?JSON.parse(e):[]}function submitFriends(e){polAjaxForm("form#friends-form",(function(){sessionStorage.removeItem(SESSION_OBJ_INVITES),setSessionMessage(CONSTANTS.SUCCESS,"Amigos adicionados com sucesso","Seus amigos receberão as instruções por e-mail"),e.friends=[],window.location.href="./detalhes"}),(function(e){polError(e)}))}new Vue({el:"#invite-friends",data:{name:"",email:"",friends:getToDisk()},methods:{resetAddFriend:function(){this.name=this.email=""},updateDisk:function(){saveToDisk(this.friends)},addFriend:function(){this.friends.push({name:this.name,email:this.email}),this.resetAddFriend(),this.updateDisk(),document.getElementById("add-name").focus()},removeFriend:function(e){this.friends=this.friends.filter(t=>t.email!=e),this.updateDisk()},onChangeEmail:function(e){"Enter"==e.key&&this.addFriend()},sendFriends:function(){submitFriends(this)}}})}function formatDate(e){return e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()}function daysOfMonth(e,t){return new Date(t,parseInt(e)+1,0).getDate()}if(document.getElementById("deadline-wrapp")){new Vue({el:"#deadline-wrapp",data:{date:formatDate(new Date),day:(new Date).getDate(),month:(new Date).getMonth(),year:(new Date).getFullYear(),days:daysOfMonth((new Date).getMonth(),(new Date).getFullYear()),months:[{index:0,name:"Janeiro"},{index:1,name:"Fevereiro"},{index:2,name:"Março"},{index:3,name:"Abril"},{index:4,name:"Maio"},{index:5,name:"Junho"},{index:6,name:"Julho"},{index:7,name:"Agosto"},{index:8,name:"Setembro"},{index:9,name:"Outubro"},{index:10,name:"Novembro"},{index:11,name:"Dezembro"}],years:[(new Date).getFullYear(),(new Date).getFullYear()+1]},methods:{updateDate:function(e){const t=e.target;"date_day"===t.id?this.day=t.value:("date_year"===t.id?this.year=t.value:"date_month"===t.id&&(this.month=t.value),this.days=daysOfMonth(this.month,this.year)),this.date=formatDate(new Date(this.year,this.month,this.day)),this.checkDate()},checkDate:function(){const e=document.getElementById("deadline");e.classList.remove("error");const t=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),n=this.date.split("/"),a=new Date(n[2],n[1]-1,n[0]),i=t.getTime(),r=a.getTime();(!r||r<i)&&e.classList.add("error")}}})}document.querySelectorAll(".tribute_delete_invite").length&&jQuery(".tribute_delete_invite").click((function(e){e.preventDefault(),polSpinner();let t=jQuery(e.currentTarget).attr("data_invite"),n=jQuery(e.currentTarget).attr("data_tribute"),a=jQuery("#wpnonce").val();jQuery.post(polenObj.ajax_url,{action:"tribute_delete_invite",invite_hash:t,tribute_hash:n,security:a},(function(e,t,n){e.success?(setSessionMessage(CONSTANTS.SUCCESS,"Sucesso",e.data),document.location.reload()):polError(e.data)})).fail((function(e,t,n){polSpinner(CONSTANTS.HIDDEN),polError("failed, "+n)}))}));