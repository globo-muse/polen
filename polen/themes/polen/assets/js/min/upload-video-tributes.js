let response,form=document.querySelector("#form-video-upload"),file_input=document.querySelector("#file-video"),progress=document.querySelector("#progress"),content_info=document.getElementById("content-info"),content_upload=document.getElementById("content-upload"),progress_value=document.getElementById("progress-value"),video_input=document.getElementById("file-video"),video_name=document.getElementById("video-file-name"),video_rec_click=document.querySelectorAll(".video-rec"),invite_hash_input=document.getElementById("tribute_invite_hash"),invite_id_input=document.getElementById("tribute_invite_id"),tribute_hash_input=document.getElementById("tribute_hash");const duracaoMinima=10,duracaoMaxima=65;let videoDuration;function showFileName(){document.getElementById("info").innerText=file_input.files[0].name}function setFileInfo(){var e=file_input.files,o=document.createElement("video");o.preload="metadata",o.onloadedmetadata=function(){window.URL.revokeObjectURL(o.src),videoDuration=o.duration},o.src=URL.createObjectURL(e[0])}function videoIsOk(){return!0}window.URL=window.URL||window.webkitURL,window.onload=()=>{form&&(form.onsubmit=function(e){if(0==file_input.files.length)return e.preventDefault(),!1;if(!videoIsOk())return e.preventDefault(),polError("A duração do video deve ficar entre 10 e 60 segundos."),!1;console.log("Iniciando upload"),content_info.classList.remove("show"),content_upload.classList.add("show"),document.querySelector("#video-rec-again").classList.remove("show"),document.querySelector("#video-send").classList.remove("show");let o={};return o.file_size=file_input.files[0].size.toString(),o.invite_hash=invite_hash_input.value,o.invite_id=invite_id_input.value,o.tribute_hash=tribute_hash_input.value,jQuery.post(polenObj.ajax_url+"?action=tribute_create_vimeo_slot",o,(e,o,t)=>{if(200==t.status){let o=file_input.files[0];console.log(e.data.body.upload.upload_link),new tus.Upload(o,{uploadUrl:e.data.body.upload.upload_link,onError:errorHandler,onProgress:progressFunction,onSuccess:completeHandler}).start()}else console.log("deu erro")}).fail(errorHandler),e.preventDefault(),!1},video_rec_click.forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault(),video_input.click()}))})),video_input.addEventListener("change",(function(e){setFileInfo(),changeIcon(),showFileName(),document.querySelector("#video-rec").classList.remove("show"),document.querySelector("#video-rec-again").classList.add("show"),document.querySelector("#video-send").classList.add("show")})))};let completeHandler=()=>{window.location.href="./sucesso",changeText(),changeIcon(!0)},errorHandler=(e,o,t)=>{console.log(e),setSessionMessage(CONSTANTS.ERROR,null,"Erro no envio do arquivo, tente novamente"),document.location.reload()};function progressFunction(e,o){progress_value.innerText=`Enviando vídeo ${Math.floor(e/o*100)}%`}function changeText(){document.getElementById("video-message").innerText="Vídeo enviado com sucesso"}function changeIcon(e){document.querySelector(".image.wait").classList.remove("show"),document.querySelector("#content-upload").classList.remove("show"),document.querySelector(".image.complete").classList.add("show"),document.querySelector(".content-info").classList.add("show"),e&&document.querySelector(".final-button").classList.add("show")}